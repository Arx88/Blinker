# Suna Self-Hosting Guide

This guide provides detailed instructions for setting up and hosting your own instance of Suna, an open-source generalist AI agent.

## Table of Contents

- [Overview](#overview)
- [Prerequisites](#prerequisites)
- [Installation Steps](#installation-steps)
- [Manual Configuration](#manual-configuration)
- [Post-Installation Steps](#post-installation-steps)
- [Troubleshooting](#troubleshooting)

## Overview

Suna consists of four main components:

1. **Backend API** - Python/FastAPI service for REST endpoints, thread management, and LLM integration
2. **Backend Worker** - Python/Dramatiq worker service for handling agent tasks
3. **Frontend** - Next.js/React application providing the user interface
4. **Agent Docker** - Isolated execution environment for each agent
5. **Supabase Database** - Handles data persistence and authentication

## Prerequisites

Before starting the installation process, you'll need to set up the following:

### 1. Supabase Project

1. Create an account at [Supabase](https://supabase.com/)
2. Create a new project
3. Note down the following information (found in Project Settings → API):
   - Project URL (e.g., `https://abcdefg.supabase.co`)
   - API keys (anon key and service role key)

### 2. API Keys

Obtain the following API keys:

#### Required

- **LLM Provider** (at least one of the following):

  - [Anthropic](https://console.anthropic.com/) - Recommended for best performance
  - [OpenAI](https://platform.openai.com/)
  - [Groq](https://console.groq.com/)
  - [OpenRouter](https://openrouter.ai/)
  - [AWS Bedrock](https://aws.amazon.com/bedrock/)

- **Search and Web Scraping**:

  - [Tavily](https://tavily.com/) - For enhanced search capabilities
  - [Firecrawl](https://firecrawl.dev/) - For web scraping capabilities

- **Agent Execution**:
  - [Daytona](https://app.daytona.io/) - For secure agent execution

#### Optional

- **RapidAPI** - For accessing additional API services (optional)

### 3. Required Software

Ensure the following tools are installed on your system:

- **[Git](https://git-scm.com/downloads)**
- **[Docker](https://docs.docker.com/get-docker/)**: Essential for running Suna and its services.
- **[Python 3.11+](https://www.python.org/downloads/)**: Required for the backend and setup script.
- **[Node.js & npm](https://nodejs.org/en/download/)**: Required for the frontend.
- **Mise (optional but recommended)**: `setup.py` will offer to install it if not found. Mise helps manage tool versions specified in the project.
- **Supabase CLI (optional but recommended for local Supabase)**: `setup.py` will offer to install it if not found and you choose local mode.

The `python setup.py` script will check for Docker, Mise, and Supabase CLI and guide you if any are missing.

## Installation Steps

### 1. Clone the Repository

```bash
git clone https://github.com/kortix-ai/suna.git
cd suna
```

### 2. Run the Setup Script

The main setup script will guide you through the installation, configuration, and startup process:

```bash
python setup.py
```

The script will:
- Check if all required tools (Docker, Mise, Supabase CLI) are installed and assist with installation if needed.
- Prompt you to choose an installation mode:
    - **Local Mode**: Uses Docker to run all services locally. Recommended for ease of use.
    - **Daytona Mode**: For advanced users deploying to a remote server using Daytona.
- Collect your API keys and other configuration details.
- Store your configuration in a `.blinker_config` file (added to `.gitignore`) for persistence.
- Generate a root `.env` file with the necessary environment variables.
- Install Python and Node.js dependencies.
- Start Suna based on your chosen mode. For local mode, it will use Docker Compose.

### 3. Supabase Configuration

During setup, you'll need to:

1. Log in to the Supabase CLI
2. Link your local project to your Supabase project
3. Push database migrations
4. Manually expose the 'basejump' schema in Supabase:
   - Go to your Supabase project
   - Navigate to Project Settings → API
   - Add 'basejump' to the Exposed Schema section

Note: The `setup.py` script will guide you through Supabase login and linking if you choose the local (Docker) setup, which includes a local Supabase instance.

### 4. Daytona Configuration

As part of the setup, you'll need to:

1. Create a Daytona account
2. Generate an API key
3. Create a Docker image:
   - Image name: `kortix/suna:0.1.3`
   - Entrypoint: `/usr/bin/supervisord -n -c /etc/supervisor/conf.d/supervisord.conf`

Note: If you select Daytona mode during `python setup.py`, you will be prompted for necessary Daytona configurations.

## Manual Configuration

If you prefer to configure your installation manually, or if you need to modify the configuration after installation, here's what you need to know:

### Backend Configuration (.env)

The primary backend and frontend configurations are stored in a root `.env` file, which is generated by the `python setup.py` script. This file consolidates settings for all services.
It is generally not recommended to manually edit this file after `setup.py` has run, as subsequent runs of `setup.py` might overwrite it based on your `.blinker_config`. Manage your settings through `python setup.py` when possible.

Example (minimal, actual content generated by `setup.py`):

```sh
# Environment Mode
ENV_MODE=local

# DATABASE
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_ANON_KEY=your-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key

# REDIS
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_SSL=false

# RABBITMQ
RABBITMQ_HOST=rabbitmq
RABBITMQ_PORT=5672

# LLM Providers
ANTHROPIC_API_KEY=your-anthropic-key
OPENAI_API_KEY=your-openai-key
MODEL_TO_USE=anthropic/claude-3-7-sonnet-latest

# WEB SEARCH
TAVILY_API_KEY=your-tavily-key

# WEB SCRAPE
FIRECRAWL_API_KEY=your-firecrawl-key
FIRECRAWL_URL=https://api.firecrawl.dev

# Sandbox container provider
DAYTONA_API_KEY=your-daytona-key
DAYTONA_SERVER_URL=https://app.daytona.io/api
DAYTONA_TARGET=us

NEXT_PUBLIC_URL=http://localhost:3000
# ... other keys like RAPIDAPI_KEY_ZILLOW, BLINKER_SETUP_MODE etc.
```

### Frontend Configuration (.env.local)

Next.js loads environment variables from the root `.env` file (for variables starting with `NEXT_PUBLIC_`). While you can use `frontend/.env.local` for frontend-specific overrides during development, the main configuration managed by `setup.py` resides in the root `.env`.
It is generally not recommended to duplicate variables from the root `.env` into `frontend/.env.local` unless for specific, temporary overrides.

Example (minimal, if needed for overrides):
```sh
# Example: Overriding a Next.js public variable for local frontend development only
# NEXT_PUBLIC_SOME_FEATURE_FLAG=true
```

## Post-Installation Steps

After completing the installation, you'll need to:

1. **Create an account** - Use Supabase authentication to create your first account
2. **Verify installations** - Check that all components are running correctly

## Starting and Stopping Suna

The `python setup.py` script is the primary way to start Suna after the initial setup. If you run it again, it will use your saved configuration (from `.blinker_config`) and attempt to start the services.

-   **To Start Suna**:
    ```bash
    python setup.py
    ```
    (If services are already running, it might prompt or attempt to restart them based on its logic).

-   **To Stop Suna (Local Docker Mode)**:
    If you started Suna in local Docker mode, you can stop the services using:
    ```bash
    docker-compose down
    ```
    (This command should be run from the root directory of the project where `docker-compose.yaml` is located).

## Troubleshooting

### Common Issues

1. **Docker services not starting**

   - Check Docker logs: `docker-compose logs -f` (run from the project root)
   - Ensure Docker is running correctly.
   - Verify port availability (e.g., 3000 for frontend, 8000 for backend, 54322 for local Supabase). `setup.py` or `docker-compose` should report port conflicts.

2. **Database connection issues**

   - Verify Supabase configuration in your `.env` file (generated by `setup.py`).
   - For local Supabase (Docker mode), ensure the Supabase containers are running: `docker-compose ps`.
   - Check if the `basejump` schema is exposed in your Supabase project settings (Project Settings → API → Exposed schemas). `setup.py` attempts to guide you but manual verification might be needed for cloud Supabase.

3. **LLM API key issues**

   - Verify API keys in your `.env` file.
   - Check for API usage limits or restrictions with your LLM provider.

4. **Daytona connection issues (if using Daytona mode)**
   - Verify Daytona API key and server URL in your `.env` file.
   - Ensure your Daytona target is correctly configured and accessible.
   - Check the Daytona agent image configuration.

### Logs

To view logs and diagnose issues when running in **Local Docker Mode**:

```bash
# View logs for all services
docker-compose logs -f

# View logs for a specific service (e.g., backend)
docker-compose logs -f backend

# View logs for local Supabase services
docker-compose logs -f supabase # (Or specific Supabase containers like supabase-db, supabase-kong)
```
If you encounter issues with `setup.py` itself, the script will print errors to the console.
For Daytona mode, refer to Daytona's documentation for accessing logs from your Daytona workspace.

---

For further assistance, join the [Suna Discord Community](https://discord.gg/Py6pCBUUPw) or check the [GitHub repository](https://github.com/kortix-ai/suna) for updates and issues.
